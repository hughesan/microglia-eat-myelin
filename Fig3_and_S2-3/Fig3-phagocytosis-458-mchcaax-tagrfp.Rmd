---
title: "Phago 4-5-8 dpf mcherry-caax and tagrfp"
author: "alexandria hughes"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(ggpubr)
library(cowplot)
library(colorspace)
```

```{r}
theme_set(theme_cowplot(font_size =18))
```

```{r}
master_phago <- read_csv('tidy_4-5-8-baf-dmso-phago.csv')
#View(master_phago)
```

```{r}
master_phago$treatment <- master_phago$treatment %>% fct_relevel("dmso", "baf")
```

```{r}
master_phago <- master_phago %>% mutate(treatment2 = if_else(treatment == "baf", "Bafilomycin A1", "DMSO"))
#View(master_phago)
```

```{r}
master_phago$treatment2 <- master_phago$treatment2 %>% fct_relevel("DMSO", "Bafilomycin A1")
```

```{r}
master_phago <- master_phago %>% group_by(age, cell_id, treatment, fluor) %>% mutate(obj_area_fraction = sum(puncta_area)/mean(cell_area)) %>% mutate(sum_puncta_areas = sum(puncta_area))
```

```{r}
phago_baf <- master_phago %>% filter(fluor == "mCherry-CAAX") %>% filter(treatment == "baf")
```

Get number of puncta by getting the max id number per cell. The filter step limits output to one row per cell.
```{r}
phago_baf_npuncta <- phago_baf %>% group_by(age, cell_id, treatment, fluor) %>% mutate(n_puncta = max(puncta_id))%>% filter(puncta_id == 1)
View(phago_baf_npuncta)                                                                                       
                                                                                
```

Puncta engulfment across age
```{r}
ggplot(phago_baf_npuncta, aes(x=age, y=n_puncta, fill=age))+
  geom_violin(aes(x=age, y=n_puncta), fill = "#E3C22D", color= "#777777", size=1, alpha=0.5, linetype="longdash", scale="width", trim=FALSE, draw_quantiles = c(0.25, 0.5, 0.75))+
  geom_jitter(width=0.225, height=0.2, shape=21, size=7, alpha=0.8)+
  scale_fill_manual(values= c("#FFC5FF", "#FFC5FF", "#FFC5FF"))+
  stat_compare_means(method="kruskal.test", label="p.signif", size=5.5, label.y=20, label.x=1.97)+ 
  theme(legend.position= "none")+
  labs(x = " ", y=" # myelin puncta / microglia")
#ggsave('phago graphs 2-5-19/phago-baf-age458-violins.png', dpi=300, width=6, height=4.5)
```

```{r}
master_phago_notag_48 <- master_phago %>% filter(fluor == "mCherry-CAAX") %>% filter(age == "4 dpf" | age == "8 dpf") %>% group_by(age, cell_id, treatment) %>% mutate(n_puncta = max(puncta_id))%>% filter(puncta_id == 1 | n_puncta == 0)
View(master_phago_notag_48)
```

number of puncta per microglia, violin plot (histogram a bit below)
```{r}
ggplot(master_phago_notag_48, aes(x=treatment2, y=n_puncta, fill=treatment2))+
  geom_violin(aes(x=treatment2, y=n_puncta), fill = "#E3C22D", color= "#777777", size=1, alpha=0.5, linetype="longdash", scale="width", trim=FALSE, draw_quantiles = c(0.25, 0.5, 0.75))+
  geom_jitter(width=0.25, height=0.250, shape=21, size=7, alpha=0.75)+

  scale_fill_manual(values= c("#FFC5FF", "#FFC5FF"))+
  stat_compare_means(inherit.aes=FALSE, aes(x=treatment2, y=n_puncta), method = "wilcox.test", label = "p.format", size=5.5, label.x=1.3, label.y=18.5)+
  theme(legend.position = "none")+
  labs(x = " ", y="Myelin puncta / microglia")
#ggsave('phago graphs 2-5-19/puncta-per-microglia-violin.png', dpi=300)

 
```

Myelin area per microglia
```{r}
#This one
ggplot(master_phago_notag_48, aes(x=treatment2, y=sum_puncta_areas, fill=treatment2))+
  geom_violin(aes(x=treatment2, y=sum_puncta_areas), fill = "#E3C22D", color= "#777777", size=1, alpha=0.5, linetype="longdash", scale="width", trim=FALSE, draw_quantiles = c(0.25, 0.5, 0.75))+
  geom_jitter(width=0.25, height=0.250, shape=21, size=7, alpha=0.75)+
  #scale_fill_discrete_diverging(15, palette = "Blue Yellow 3", c1=100, h1=285, h2=285, l1=90, l2=68)+
  scale_fill_manual(values= c("#FFC5FF", "#FFC5FF"))+
  stat_compare_means(inherit.aes=FALSE, aes(x=treatment2, y=sum_puncta_areas), method = "wilcox.test", label = "p.format", size=5.5, label.x=1.3, label.y=18.5)+
  theme(legend.position = "none")+
  labs(x = " ")+
  ylab(bquote(`Myelin area / microglia (`*um^2~`)`))
#ggsave('phago graphs 2-5-19/myelin-area-per-mg-dmso-baf.png', dpi=300, width=6, height=4.5)
```


histogram of puncta # engulfed in baf and dmso groups
```{r}
ggplot(master_phago_notag_48, aes(x=n_puncta, fill=treatment2))+
  geom_histogram(position = "dodge", binwidth=1, aes(y=..density..), alpha=0.75, color="black")+

  scale_fill_manual(values=c("#E3C22D", "#FFC5FF"))+
  geom_density(inherit.aes=FALSE, aes(x=n_puncta, fill=treatment2), alpha=.2)+
  labs(x="# myelin puncta / microglia", y="Density", fill = " ")+
  theme(legend.position = c(.67, .8))
  
#ggsave('phago graphs 2-5-19/baf-dmso-histogram.png', dpi=300, width=6.5, height=4.5)


```

How big are the puncta? First filter out the actual puncta (cells w/o puncta have puncta area set equal to 0, so get rid of those)
```{r}
master_phago_notag_48_Allpuncta <- master_phago %>% filter(fluor == "mCherry-CAAX") %>% filter(age == "4 dpf" | age == "8 dpf") %>% filter(puncta_area > 0)
View(master_phago_notag_48_Allpuncta)
```

```{r}
ggplot(master_phago_notag_48_Allpuncta, aes(x=treatment2, y=puncta_area, fill=factor(cell_id)))+
  geom_violin(aes(x=treatment2, y=puncta_area), fill = "#E3C22D", color= "#777777", size=1, alpha=0.5, linetype="longdash", scale="width", trim=FALSE, draw_quantiles = c(0.25, 0.5, 0.75))+
  geom_jitter(width=0.2, shape=21, size=4, alpha=0.75)+
  scale_fill_discrete_diverging(15, palette = "Blue Yellow 3", c1=100, h1=285, h2=285, l1=90, l2=68)+
  stat_compare_means(inherit.aes=FALSE, aes(x=treatment2, y=puncta_area), method = "wilcox.test", label = "p.format", size=5.5, label.x=1.35)+
  theme(legend.position = "none")+
  ylab(bquote(`Myelin punctum area (`*um^2~`)`))+
  labs(x=" ")
#ggsave('phago graphs 2-5-19/punctum-area-dmso-baf-48.png', dpi=300, width=6, height=4.5)
```


mCherry-CAAX vs TagRFP engulfment
```{r}
phago_tag_vs_caax_4dpf <- master_phago %>% filter(age == "4 dpf") %>% group_by(age, cell_id, treatment, fluor) %>% mutate(n_puncta = max(puncta_id))%>% filter(puncta_id == 1 | n_puncta == 0)
View(phago_tag_vs_caax_4dpf)
```

```{r}
ggplot(phago_tag_vs_caax_4dpf, aes(x=fluor, y=n_puncta, fill=fluor))+
 # geom_violin(aes(x=fluor, y=n_puncta), fill = "#E3C22D", color= "#777777", size=1, alpha=0.5, linetype="longdash", scale="width", trim=FALSE, draw_quantiles = c(0.25, 0.5, 0.75))+
  
  geom_jitter(width=0.15, shape=21, size=5, alpha=0.75)+
  geom_boxplot(alpha=0.5)+
  facet_grid(.~treatment2)+
  stat_compare_means(inherit.aes=FALSE, aes(x=fluor, y=n_puncta), method = "wilcox.test", label = "p.format", label.x=1.3, label.y=15, size=5)+
#scale_fill_discrete_diverging(4, palette = "Blue Yellow 3", c1=100, h1=285, h2=295, l1=90, l2=68)+
  scale_fill_manual(values= c("#E3C22D", "#FFC5FF"))+
theme(legend.position = "none")+
  labs(x= " ", y="# RFP puncta / microglia")
#ggsave('phago graphs 2-5-19/caax-vs-tag-dmso-baf.png', dpi=300, width=6.5, height = 4.5)
```

